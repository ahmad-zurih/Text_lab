#!/usr/bin/env bash

# Configurable TEXT_LAB_DIR with a default value
HOST_ROOT_DIR="${TEXT_LAB_DIR:-/storage/research/dsl_shared/solutions/ondemand/text_lab}"
CONT_ROOT_DIR="/text_lab"
CONTAINER="$HOST_ROOT_DIR/container/text_lab.sif"

# --- Clean the Python environment ---
unset PYTHONPATH
unset PYTHONHOME
export PYTHONNOUSERSITE=1

# Optionally: explicitly set HOME and USER for environment isolation
export HOME="$HOME"
export USER="$USER"

pushd "${PWD}"

apptainer exec --nv --bind $HOST_ROOT_DIR:$CONT_ROOT_DIR $CONTAINER \
  /usr/bin/python3 -m streamlit run $CONT_ROOT_DIR/src/Home.py \
    --server.port "$SERVER_PORT" \
    --server.baseUrlPath "$SERVER_BASEURLPATH" \
    --server.enableCORS false \
    --server.headless true \
    --server.maxUploadSize=500 \
    --client.showErrorDetails= false

popd
